# 創建管理員帳號 - 完整步驟

## 問題：找不到該登入名稱的帳號

這個錯誤表示 `user_profiles` 表中沒有 `login_name = 'a000001'` 的記錄。

## 解決方案

### 方法一：使用快速修復腳本（推薦）

1. **確認 Auth 用戶已創建**
   - 進入 Supabase Dashboard
   - 點擊 `Authentication` > `Users`
   - 檢查是否有 email = `jimmy@your-remit.com` 的用戶
   - 如果沒有，點擊 `Add user` > `Create new user`
     - Email: `jimmy@your-remit.com`
     - Password: `Admin@1234`
     - 取消勾選 `Auto Confirm User`（如果需要）

2. **執行快速修復腳本**
   - 進入 Supabase Dashboard > `SQL Editor`
   - 執行 `quick-fix-admin.sql` 腳本
   - 腳本會自動：
     - 查找 Auth 用戶
     - 創建或更新 `user_profiles` 記錄
     - 設定登入名稱為 `a000001`
     - 設定為系統管理員角色

3. **驗證結果**
   - 腳本執行後會顯示驗證結果
   - 確認狀態顯示為 `✓ 帳號正常`

4. **登入測試**
   - 登入名稱：`a000001`
   - 密碼：`Admin@1234`

### 方法二：手動執行 SQL（如果方法一失敗）

如果快速修復腳本失敗，請按以下步驟手動執行：

#### 步驟 1：確認 Auth 用戶 ID

```sql
-- 查找 Auth 用戶 ID
SELECT id, email, created_at
FROM auth.users
WHERE email = 'jimmy@your-remit.com';
```

記下返回的 `id`（UUID 格式）

#### 步驟 2：獲取管理員角色 ID

```sql
-- 獲取或創建管理員角色
SELECT id FROM user_roles WHERE name = '系統管理員';

-- 如果沒有，執行：
INSERT INTO user_roles (name, description, permissions) 
VALUES ('系統管理員', '擁有所有系統權限', '{"all": true}')
RETURNING id;
```

記下返回的角色 `id`

#### 步驟 3：創建 user_profiles 記錄

將以下 SQL 中的 `YOUR_USER_ID` 和 `YOUR_ROLE_ID` 替換為步驟 1 和 2 獲取的 ID：

```sql
INSERT INTO user_profiles (
  id,
  login_name,
  email,
  full_name,
  role_id,
  department,
  is_active,
  requires_attendance,
  two_factor_enabled
) VALUES (
  'YOUR_USER_ID',  -- 替換為步驟 1 的用戶 ID
  'a000001',
  'jimmy@your-remit.com',
  '系統管理員',
  'YOUR_ROLE_ID',  -- 替換為步驟 2 的角色 ID
  '管理部',
  true,
  false,
  false
)
ON CONFLICT (id) 
DO UPDATE SET
  login_name = 'a000001',
  email = 'jimmy@your-remit.com',
  full_name = '系統管理員',
  role_id = 'YOUR_ROLE_ID',
  is_active = true,
  requires_attendance = false,
  two_factor_enabled = false,
  updated_at = NOW();
```

#### 步驟 4：驗證

```sql
SELECT 
  login_name,
  email,
  full_name,
  is_active,
  (SELECT name FROM user_roles WHERE id = user_profiles.role_id) as role_name
FROM user_profiles
WHERE login_name = 'a000001';
```

應該會看到一條記錄，`is_active` 為 `true`。

### 方法三：使用不同的 Email（如果 jimmy@your-remit.com 不存在）

如果您想使用不同的 email，請修改 `quick-fix-admin.sql` 中的這一行：

```sql
user_email TEXT := 'your-email@example.com';  -- 改為您的 email
```

然後：
1. 在 Supabase Auth 中創建該 email 的用戶
2. 執行修改後的腳本

## 常見問題

### Q1: 執行腳本後還是找不到帳號？

**檢查項目：**
1. 確認 `user_profiles` 表中是否有記錄：
   ```sql
   SELECT * FROM user_profiles WHERE login_name = 'a000001';
   ```
2. 確認 `is_active` 是否為 `true`：
   ```sql
   SELECT login_name, email, is_active FROM user_profiles WHERE login_name = 'a000001';
   ```
3. 檢查 RLS 政策是否允許查詢：
   - 進入 Supabase Dashboard > `Authentication` > `Policies`
   - 確認 `user_profiles` 表的 SELECT 政策允許查詢

### Q2: Auth 用戶已創建，但腳本說找不到？

**可能原因：**
- Email 拼寫錯誤
- Email 大小寫不一致（Supabase 的 email 是大小寫敏感的）

**解決方案：**
```sql
-- 查看所有 Auth 用戶的 email
SELECT id, email FROM auth.users ORDER BY created_at DESC LIMIT 10;
```

確認 email 是否完全一致（包括大小寫）。

### Q3: 登入時提示密碼錯誤？

**檢查：**
1. 確認 Auth 用戶的密碼是否為 `Admin@1234`
2. 如果忘記密碼，可以在 Supabase Dashboard > Authentication > Users 中重置

### Q4: 想使用不同的登入名稱？

修改 `quick-fix-admin.sql` 中的 `login_name`：

```sql
login_name = 'a000001',  -- 改為您想要的登入名稱（格式：小寫字母+6位數字）
```

例如：`b123456`, `c789012` 等。

## 登入資訊總結

執行成功後，使用以下資訊登入：

- **登入名稱**：`a000001`
- **密碼**：`Admin@1234`
- **電子郵件**：`jimmy@your-remit.com`

## 重要提醒

1. **首次登入後請立即修改密碼**
2. **建議在「員工管理」頁面完善管理員的個人資料**
3. **可以修改 email 為您的實際郵箱地址**
