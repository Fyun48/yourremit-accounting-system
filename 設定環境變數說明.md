# 設定環境變數說明

## 問題
診斷結果顯示 `SUPABASE_SERVICE_ROLE_KEY` 環境變數未設定，這會導致新增員工功能無法正常運作。

## 解決步驟

### 步驟 1：取得 Supabase Service Role Key

1. 登入 Supabase Dashboard
2. 前往 **Settings** > **API**
3. 在 **Project API keys** 區塊中找到 **service_role** key
4. 點擊 **Reveal** 顯示完整的 key（注意：這個 key 有完整權限，請妥善保管）

### 步驟 2：設定環境變數

#### 方法 A：在 `.env.local` 檔案中設定（推薦）

1. 在專案根目錄創建或編輯 `.env.local` 檔案
2. 添加以下內容：

```env
NEXT_PUBLIC_SUPABASE_URL=你的 Supabase URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的 Anon Key
SUPABASE_SERVICE_ROLE_KEY=你的 Service Role Key
```

**範例：**
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### 方法 B：在系統環境變數中設定

**Windows (PowerShell):**
```powershell
$env:SUPABASE_SERVICE_ROLE_KEY="你的 Service Role Key"
```

**Windows (CMD):**
```cmd
set SUPABASE_SERVICE_ROLE_KEY=你的 Service Role Key
```

**Linux/Mac:**
```bash
export SUPABASE_SERVICE_ROLE_KEY="你的 Service Role Key"
```

### 步驟 3：重新啟動開發伺服器

設定環境變數後，**必須重新啟動 Next.js 開發伺服器**才能生效：

1. 停止目前的開發伺服器（按 `Ctrl+C`）
2. 重新啟動：
   ```bash
   npm run dev
   ```

### 步驟 4：驗證設定

訪問診斷 API 確認設定是否正確：
```
http://localhost:3000/api/diagnose
```

應該看到：
```json
{
  "checks": [
    {
      "name": "環境變數檢查",
      "status": "pass",
      "details": {
        "NEXT_PUBLIC_SUPABASE_URL": "已設定",
        "NEXT_PUBLIC_SUPABASE_ANON_KEY": "已設定",
        "SUPABASE_SERVICE_ROLE_KEY": "已設定"
      }
    }
  ]
}
```

## 重要提醒

⚠️ **安全注意事項：**

1. **不要將 `.env.local` 檔案提交到 Git**
   - 確認 `.gitignore` 檔案包含 `.env.local`
   - Service Role Key 有完整資料庫權限，絕對不能公開

2. **生產環境設定**
   - 在部署平台（如 Netlify、Vercel）的環境變數設定中添加 `SUPABASE_SERVICE_ROLE_KEY`
   - 不要在程式碼中硬編碼這個 key

3. **如果 Service Role Key 洩露**
   - 立即在 Supabase Dashboard 中重新生成新的 key
   - 更新所有使用該 key 的地方

## 故障排除

### 問題：設定後仍然顯示未設定

1. 確認檔案名稱是 `.env.local`（不是 `.env` 或 `.env.local.txt`）
2. 確認檔案在專案根目錄（與 `package.json` 同層）
3. 確認沒有多餘的空格或引號
4. 重新啟動開發伺服器

### 問題：找不到 Supabase Dashboard

1. 前往 https://supabase.com/dashboard
2. 選擇你的專案
3. 前往 Settings > API

### 問題：無法找到 Service Role Key

1. 在 Supabase Dashboard > Settings > API
2. 找到 **Project API keys** 區塊
3. 找到標示為 **service_role** 的 key（通常是第二個）
4. 點擊 **Reveal** 按鈕顯示完整 key
