# 系統測試檢查清單

## 📋 資料庫設置確認

### ✅ 已完成
- [x] 執行 `database-setup.sql`（基礎資料庫）
- [x] 執行 `database-extensions.sql`（功能擴展）

### ⚠️ 需要執行
- [ ] 執行 `database-supplement.sql`（補充會計科目）

**重要**：必須執行補充腳本，否則匯款交易自動分錄功能無法正常運作（缺少銷項稅額科目）。

## 🧪 功能測試清單

### 1. 信託專戶管理測試
- [ ] 前往「信託專戶」頁面
- [ ] 新增一個「客戶信託」類型的專戶
  - 專戶代號：例如 `TRUST-001`
  - 專戶名稱：例如 `客戶信託專戶-台幣`
  - 銀行名稱：例如 `台灣銀行`
  - 帳號：例如 `1234567890`
- [ ] 新增一個「公司自有」類型的專戶
- [ ] 確認統計卡片顯示正確
- [ ] 測試搜尋和篩選功能

### 2. 匯款交易管理測試
- [ ] 前往「匯款交易」頁面
- [ ] 新增一筆匯款交易：
  - 客戶姓名：測試客戶
  - 匯款金額（本金）：10,000
  - 手續費：150
  - 總金額應自動計算為：10,150
  - 選擇信託專戶
  - 付款方式：便利商店
  - **狀態設為「已收款」**（這會觸發自動分錄）
- [ ] 檢查是否自動生成會計分錄
  - 前往「會計分錄」頁面
  - 應該看到一筆新的分錄，包含：
    - 借：信託專戶存款 10,150
    - 貸：代付款項 10,000
    - 貸：手續費收入 142.5（150 - 7.5）
    - 貸：銷項稅額 7.5（150 * 5%）
- [ ] 測試狀態變更（待處理 → 已收款 → 已匯出）
- [ ] 測試搜尋和篩選功能

### 3. 日結作業測試
- [ ] 前往「日結作業」頁面
- [ ] 選擇今天日期
- [ ] 確認日計表自動計算：
  - 今日總收款（TWD）
  - 今日總匯出
  - 今日手續費收入
  - 專戶餘額
  - 公司帳戶餘額
  - 交易筆數
- [ ] 點擊「執行日結」
- [ ] 確認日結記錄已建立
- [ ] 檢查是否生成日結傳票

### 4. 常用分錄樣板測試
- [ ] 前往「會計分錄」頁面
- [ ] 點擊「管理樣板」
- [ ] 新增一個樣板：
  - 名稱：每月房租
  - 分類：房租
  - 添加明細：
    - 借：租金費用 30,000
    - 貸：銀行存款 30,000
- [ ] 點擊「新增分錄」
- [ ] 選擇剛才建立的樣板
- [ ] 確認樣板內容已載入
- [ ] 修改金額和日期
- [ ] 儲存分錄
- [ ] 測試「儲存為樣板」功能

### 5. 會計分錄測試
- [ ] 手動新增一筆會計分錄
- [ ] 確認借貸平衡驗證
- [ ] 測試過帳功能
- [ ] 測試作廢功能
- [ ] 檢查總分類帳是否正確顯示

### 6. 總分類帳測試
- [ ] 前往「總分類帳」頁面
- [ ] 選擇「信託專戶-台幣」科目
- [ ] 確認餘額計算正確
- [ ] 檢查交易明細是否正確顯示

### 7. 試算表測試
- [ ] 前往「試算表」頁面
- [ ] 確認借貸總額平衡
- [ ] 檢查各科目餘額是否正確

## ⚠️ 常見問題排查

### 問題 1：匯款交易無法自動生成分錄
**可能原因**：
- 缺少必要的會計科目（銷項稅額、代付款項、手續費收入）
- 信託專戶未正確設定

**解決方法**：
1. 執行 `database-supplement.sql`
2. 前往「系統設定」→「會計科目」，確認以下科目存在：
   - 1121 信託專戶-台幣
   - 2001 代付款項
   - 4101 匯款手續費收入
   - 2199 銷項稅額

### 問題 2：日結計算不正確
**可能原因**：
- 匯款交易狀態未設為「已收款」或「已匯出」
- 會計分錄未過帳

**解決方法**：
1. 確認匯款交易狀態正確
2. 確認相關會計分錄已過帳

### 問題 3：專戶餘額顯示為 0
**可能原因**：
- 會計科目代號不匹配
- 會計分錄未過帳

**解決方法**：
1. 檢查信託專戶的 account_code 是否與會計科目 code 一致
2. 確認會計分錄已過帳

## 📝 測試數據建議

### 測試場景 1：基本匯款流程
1. 新增信託專戶：`TRUST-001` - 客戶信託專戶-台幣
2. 新增匯款交易：
   - 客戶：張三
   - 匯款金額：10,000
   - 手續費：150
   - 專戶：TRUST-001
   - 狀態：已收款
3. 檢查自動生成的分錄
4. 執行日結

### 測試場景 2：多筆交易
1. 新增 3-5 筆匯款交易
2. 部分設為「已收款」，部分設為「待處理」
3. 執行日結，確認統計正確

### 測試場景 3：樣板功能
1. 建立「每月房租」樣板
2. 從樣板建立分錄
3. 修改金額後儲存

## ✅ 測試完成確認

完成以上測試後，系統應該可以正常運作。如果遇到任何問題，請檢查：
1. 資料庫表格是否正確建立
2. 會計科目是否完整
3. RLS 政策是否正確設定
4. 瀏覽器控制台是否有錯誤訊息

---

**測試日期**: _______________
**測試人員**: _______________
**測試結果**: □ 通過  □ 部分通過  □ 未通過

