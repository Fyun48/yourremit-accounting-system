# 員工登入名稱（員工編號）命名規則

## 概述

員工登入名稱（同時也是員工編號）採用固定8位字符的格式，用於唯一識別每位員工。

## 命名格式

登入名稱總長度：**8位字符**

格式結構：`[部門層級代碼(3位)] + [公司數字代號(2位)] + [員工序號(3位)]`

### 範例

- `UUI01001` - 資訊部（I）員工，公司代號01，序號001
- `UFI02005` - 財務部（F）下層部門員工，公司代號02，序號005
- `CCI03010` - 管理部（C）下層部門員工，公司代號03，序號010

---

## 詳細說明

### 1. 部門層級代碼（3位英文字母）

#### 規則
- **位置**：登入名稱的前3位
- **組成**：從上層部門到下層部門的代碼，按層級順序排列
- **不足3層處理**：如果部門層級不足3層，使用 `U` 補齊到3位
- **超過3層處理**：如果部門層級超過3層，只取最後3層的代碼

#### 範例

**範例1：單層部門（資訊部，代碼 I）**
- 部門路徑：`資訊部 (I)`
- 部門代碼：`I`
- 補齊後：`UUI`（不足3層，前面補2個U）

**範例2：兩層部門（財務部下設會計組，代碼 F → A）**
- 部門路徑：`財務部 (F) → 會計組 (A)`
- 部門代碼：`FA`
- 補齊後：`UFA`（不足3層，前面補1個U）

**範例3：三層部門（管理部下設人事部，人事部下設招聘組，代碼 C → H → R）**
- 部門路徑：`管理部 (C) → 人事部 (H) → 招聘組 (R)`
- 部門代碼：`CHR`（正好3層，不需要補齊）

**範例4：超過三層（只取最後3層）**
- 部門路徑：`管理部 (C) → 人事部 (H) → 招聘組 (R) → 實習生組 (I)`
- 部門代碼：`HRI`（只取最後3層：H, R, I）

---

### 2. 公司數字代號（2位數字）

#### 規則
- **位置**：登入名稱的第4-5位
- **格式**：2位數字，不足2位前面補0
- **來源**：公司在「公司管理」中設定的「公司數字代號」

#### 範例
- 公司代號 `1` → `01`
- 公司代號 `10` → `10`
- 公司代號 `99` → `99`

---

### 3. 員工序號（3位數字）

#### 規則
- **位置**：登入名稱的最後3位
- **格式**：3位數字，不足3位前面補0
- **生成規則**：
  1. 系統自動查詢該公司、該部門組合下已存在的員工
  2. 找出最大的員工序號
  3. 新員工的序號 = 最大序號 + 1
  4. 如果該組合下沒有任何員工，則從 `000` 開始，序號為 `001`

#### 範例

**情況1：該公司該部門組合下已有員工**
- 已有員工：`UUI01001`, `UUI01002`, `UUI01005`
- 最大序號：`005`
- 新員工序號：`006`
- 新登入名稱：`UUI01006`

**情況2：該公司該部門組合下沒有員工**
- 已有員工：無
- 最大序號：`000`（預設）
- 新員工序號：`001`
- 新登入名稱：`UUI01001`

---

## 部門代碼規則

### 部門代碼格式
- **長度**：只能是一個字符
- **格式**：一個英文字母（A-Z）或一個數字（0-9）
- **大小寫**：系統自動轉換為大寫

### 預設部門代號

系統提供以下預設部門代號，方便快速建立常用部門：

| 代號 | 部門名稱 |
|------|---------|
| I | 資訊部 |
| F | 財務部 |
| C | 管理部 |
| A | 行政部 |
| B | 董事會 |
| S | 業務部 |
| P | 產品部 |
| M | 行銷部 |

### 預設部門代號使用規則

1. **首次使用預設代號**：
   - 可以直接創建頂層部門（不需要選擇上層部門）
   - 例如：直接創建「資訊部」，代號 `I`

2. **重複使用預設代號**：
   - 如果該公司已有相同代號的頂層部門，則必須選擇上層部門才能新增
   - 例如：已有「資訊部 (I)」，要再新增「資訊部 (I)」時，必須選擇上層部門

3. **自定義部門代號**：
   - 可以使用任何一個英文字母或數字作為部門代號
   - 不受預設代號限制

---

## 部門層級限制

### 規則
- **最多3層**：部門結構最多只能有3層
- **層級計算**：
  - 第1層（頂層）：沒有上層部門的部門
  - 第2層：上層部門為第1層的部門
  - 第3層：上層部門為第2層的部門

### 範例

**有效的部門結構（3層）：**
```
管理部 (C) - 第1層
  └─ 人事部 (H) - 第2層
      └─ 招聘組 (R) - 第3層
```

**無效的部門結構（超過3層）：**
```
管理部 (C) - 第1層
  └─ 人事部 (H) - 第2層
      └─ 招聘組 (R) - 第3層
          └─ 實習生組 (I) - 第4層 ❌（不允許）
```

---

## 完整範例

### 範例1：資訊部員工

**設定：**
- 公司：金優匯股份有限公司（數字代號：01）
- 部門：資訊部（代碼：I，單層）
- 該部門已有員工：無

**生成過程：**
1. 部門層級代碼：`I` → 補齊為 `UUI`
2. 公司數字代號：`01`
3. 員工序號：`001`（首次，從000+1）
4. **登入名稱**：`UUI01001`

---

### 範例2：財務部會計組員工

**設定：**
- 公司：金優匯股份有限公司（數字代號：01）
- 部門：財務部（代碼：F）→ 會計組（代碼：A）
- 該部門已有員工：`UFA01001`, `UFA01002`

**生成過程：**
1. 部門層級代碼：`FA` → 補齊為 `UFA`
2. 公司數字代號：`01`
3. 員工序號：`003`（最大序號002 + 1）
4. **登入名稱**：`UFA01003`

---

### 範例3：管理部人事部招聘組員工

**設定：**
- 公司：金優匯股份有限公司（數字代號：01）
- 部門：管理部（代碼：C）→ 人事部（代碼：H）→ 招聘組（代碼：R）
- 該部門已有員工：`CHR01015`

**生成過程：**
1. 部門層級代碼：`CHR`（正好3層，不需要補齊）
2. 公司數字代號：`01`
3. 員工序號：`016`（最大序號015 + 1）
4. **登入名稱**：`CHR01016`

---

## 自動生成功能

### 使用方式

1. 在「員工管理」頁面新增員工時
2. 選擇「所屬公司」
3. 選擇「所屬部門」
4. 點擊「自動生成」按鈕
5. 系統會自動生成符合規則的登入名稱

### 注意事項

- 必須先選擇公司和部門才能自動生成
- 生成的登入名稱會自動填入「登入名稱」和「員工編號」欄位
- 登入名稱一旦生成並保存，無法修改（編輯模式下欄位為禁用狀態）

---

## 驗證規則

### 登入名稱驗證

系統會驗證登入名稱是否符合以下規則：

1. **長度**：必須正好8位字符
2. **格式**：`[A-Z]{3}[0-9]{2}[0-9]{3}`
   - 前3位：大寫英文字母（部門層級代碼）
   - 第4-5位：數字（公司數字代號）
   - 最後3位：數字（員工序號）

### 範例驗證

- ✅ `UUI01001` - 正確
- ✅ `UFA02005` - 正確
- ✅ `CHR03010` - 正確
- ❌ `UUI0101` - 錯誤（只有7位）
- ❌ `UUI010001` - 錯誤（有9位）
- ❌ `uui01001` - 錯誤（前3位必須大寫）
- ❌ `UUIAB001` - 錯誤（公司代號必須是數字）

---

## 常見問題

### Q1: 為什麼我的部門代碼是 `UUI` 而不是 `I`？

**A:** 因為您的部門只有1層（資訊部），系統會自動用 `U` 補齊到3位。這是正常的，確保所有登入名稱都是8位。

### Q2: 可以手動輸入登入名稱嗎？

**A:** 可以，但必須符合8位格式規則。建議使用「自動生成」功能，避免格式錯誤。

### Q3: 如果部門層級超過3層怎麼辦？

**A:** 系統不允許創建超過3層的部門。如果嘗試創建第4層部門，系統會提示「部門層級最多只能有3層」。

### Q4: 預設部門代號可以重複使用嗎？

**A:** 可以，但必須選擇上層部門。例如：已有「資訊部 (I)」，要再新增「資訊部 (I)」時，必須選擇上層部門。

### Q5: 員工序號會重複嗎？

**A:** 不會。系統會自動檢查該公司該部門組合下的最大序號，新員工的序號 = 最大序號 + 1。

---

## 技術說明

### 資料庫欄位

- `user_profiles.login_name`：存儲登入名稱（8位）
- `user_profiles.employee_id`：存儲員工編號（與登入名稱相同）
- `user_profiles.company_id`：關聯到公司
- `user_profiles.department_id`：關聯到部門

### 查詢邏輯

生成員工序號時，系統會：
1. 查詢 `user_profiles` 表
2. 篩選條件：`company_id` = 選中的公司 AND `login_name` LIKE `[部門層級代碼][公司代號]%`
3. 提取所有匹配記錄的後3位數字（員工序號）
4. 找出最大值，+1 作為新員工的序號

---

## 更新記錄

- **2026-01-06**：初始版本
  - 定義8位登入名稱格式
  - 部門層級代碼規則（3位，不足補U）
  - 預設部門代號列表
  - 部門層級限制（最多3層）
